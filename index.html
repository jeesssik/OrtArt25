<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ORT ART â€” 6 de Noviembre</title>
  <link rel="icon" href="guit.png" type="image/png">
  <meta name="description"
    content="Line-up de ORT ART (7 de Noviembre) con temÃ¡tica bosque mÃ¡gico: estrellas, niebla y luciÃ©rnagas.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Marcellus&family=Outfit:wght@300;400;600;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/csv-js@1.0.0/csv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
</head>

<body>
  <a class="skip-link" href="#main">Saltar al contenido</a>

  <header class="site-header" role="banner">
    <h1 class="festival-title"><span class="title-text">ORT ART </span></h1>
    <h3 class="festival-subtitle"><span class="subtitle-text">6 de Noviembre</span></h3>
  </header>

  <main id="main" class="site-main" role="main">
    <section class="lineup" aria-labelledby="lineup-heading" id="app">
      <h2 id="lineup-heading">Line-Up</h2>

      <div class="timeline-container" role="group" aria-label="LÃ­nea de tiempo del evento">
        <div class="timeline-line"></div>

        <div v-for="(item, index) in eventos" :key="index" class="timeline-item" :data-time="item.hora">
          <div :class="['timeline-marker', item.tipo]"></div>
          <div class="timeline-content">
            <div class="timeline-time">{{ item.horario }}</div>
            <div class="timeline-artist">{{ item.banda }}</div>

            <div class="timeline-stage" v-if="item.tipo === 'acoustic'">
              ðŸŒ² AcÃºstico
            </div>
            <div class="timeline-stage" v-else-if="item.tipo === 'electric'">
              âš¡ ElÃ©ctrico
            </div>

          </div>
        </div>
      </div>
    </section>
  </main>



  <div class="bg" aria-hidden="true">
    <canvas id="stars"></canvas>
    <div class="mist"></div>
    <div class="fireflies"></div>


    <div class="falling-leaves"></div>
    <div class="bokeh-container"></div>
    <div class="moss moss-1"></div>
    <div class="moss moss-2"></div>
    <div class="moss moss-3"></div>
    <div class="gradient-overlay"></div>
  </div>
  <script>
    function poneElGnomo() {
  const timeline = document.querySelector('.timeline-container');

  // Elimina gnomo previo si existe
  const gnomoExistente = timeline.querySelector('.gnomo-gif');
  if (gnomoExistente) {
    gnomoExistente.remove();
  }

  const now = new Date();
  const currentMinutes = now.getHours() * 60 + now.getMinutes();

  const cards = Array.from(document.querySelectorAll('.timeline-item'));
  const times = cards.map(card => {
    const timeStr = card.querySelector('.timeline-time').textContent.trim();
    const [hour, minute] = timeStr.split(':').map(Number);
    return hour * 60 + minute;
  });

  let idx = times.findIndex(t => t > currentMinutes);
  if (idx === -1) idx = times.length - 1;
  if (idx === 0) idx = 1;

  const prevCard = cards[idx - 1];
  const nextCard = cards[idx];
  const prevTime = times[idx - 1];
  const nextTime = times[idx];

  let percent = 0;
  if (nextTime !== undefined && nextTime !== prevTime) {
    percent = (currentMinutes - prevTime) / (nextTime - prevTime);
  }

  const topPrev = prevCard.offsetTop;
  const topNext = nextCard ? nextCard.offsetTop : topPrev;
  const gnomoTop = topPrev + percent * (topNext - topPrev);

  const gnomo = document.createElement('img');
  gnomo.src = 'giphy.gif';
  gnomo.alt = 'Gnomo marcador de hora';
  gnomo.className = 'gnomo-gif';

  gnomo.style.position = 'absolute';
  gnomo.style.left = '50%';
  gnomo.style.transform = 'translateX(-50%)';
  gnomo.style.top = `${gnomoTop - 60}px`;
  gnomo.style.width = '60px';
  gnomo.style.pointerEvents = 'none';
  gnomo.style.zIndex = '30';

  timeline.style.position = 'relative';
  timeline.appendChild(gnomo);
}

    new Vue({
  el: '#app',
  data: {
    eventos: []
  },
  mounted() {
    // FunciÃ³n que trae la hoja
    const cargarEventos = () => {
      const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTmWjcpQvintbxgj4x-bJPo2irG-xNyBQ0sV6G6YT-vncGT4nEA6MxOT4gn9hHlGO3P55GgfK5LdOE8/pub?gid=0&single=true&output=csv';

      fetch(url)
        .then(res => res.text())
        .then(csvText => {
          const rows = csvText.trim().split(/\r?\n/).map(line => line.split(','));
          const headers = rows[0].map(h => h.trim().toLowerCase());
          const eventos = [];

          for (let i = 1; i < rows.length; i++) {
            const row = rows[i];
            if (!row.join('').trim()) continue;

            const obj = {};
            headers.forEach((h, j) => obj[h] = row[j] ? row[j].trim() : '');

            const esc = obj['escenario']?.toLowerCase();
            obj.tipo =
              esc.includes('elÃ©ctrico') || esc === '1'
                ? 'electric'
                : 'acoustic';

            eventos.push(obj);
          }

          this.eventos = eventos;

          // Recalcula posiciÃ³n del gnomo despuÃ©s de actualizar DOM
          setTimeout(() => {
            poneElGnomo();
          }, 100);
        })
        .catch(err => console.error('Error cargando CSV:', err));
    };

    // Primera carga
    cargarEventos();

    // Refresca cada 30 segundos
    setInterval(cargarEventos, 30000);
  }
});

  </script>
  <script src="script.js"></script>
</body>

</html>